import{d as x,Q as y,o as u,c,w as n,b as s,f as e,m as B,n as r,p as R,q as z,g as L,R as $,F as E,G as S,H as T,J as F,t as f,j as a,T as N,K as V,r as d,U as j,l as k,V as H,W as G,X as K,k as h,Y as P,Z as Q,O as Z,I as q,$ as J,a0 as O,a1 as U,a2 as W,a3 as X,a4 as Y,a5 as b,i as M,a6 as ee}from"./index-MjQ2o11G.js";import{d as m}from"./database-Jpx-SvdX.js";import{u as se,d as ne}from"./riskassessment-iOSLOJ5G.js";import{l as p}from"./livequery-abB8zLye.js";import{_ as te}from"./TemplateMainPage.vue_vue_type_script_setup_true_lang-eUXUGd65.js";import{a as _}from"./helpers-67hrFqte.js";import"./liveriskstree-ekSLVueQ.js";const me=x({__name:"RiskAssessmentListPage",setup(ie){y();const C=p.table("riskassessmentsmeta").entries(),t=se();function v(){m.riskassessments.add({...ne}).then(i=>{const l=Math.floor(Date.now()/1e3);m.riskassessmentsmeta.add({id:i,descr:"Neue Gefährdungsbeurteilung "+i,created:l,lastChange:l}).then(()=>{})})}async function w(i){return m.riskassessments.get(i).then(l=>{if(l===void 0)throw Error("riskassessment "+i+" canno be duplicated, since it does not exist in the database");return delete l.id,m.riskassessments.add(l)}).then(l=>m.riskassessmentsmeta.get(i).then(o=>{if(o===void 0)throw Error("riskassessmentMeta for riskassessment "+i+" not found in database.");const g=Math.floor(Date.now()/1e3);return m.riskassessmentsmeta.add({id:l,descr:"Kopie von "+o.descr,created:g,lastChange:g})}))}function D(i){if(t.id!==void 0)return m.riskassessmentsmeta.update(t.id,{descr:i[0]})}function A(i){t.id,t.id!==void 0&&i!==t.id&&t.modified()?_("In der geöffneten Einsatzplanung gibt es noch ungespeicherte Änderungen. Diese gehen verloren wenn eine andere geöffnet wird. Soll die Einsatzplanung trotzdem geöffnet werden?",{text:"Öffnen",role:"submit",icon:ee,handler:()=>{t.loadFromDb(i)}}):t.loadFromDb(i)}function I(i){_("Soll der Einsatzplan wirklich unwideruflich gelöscht werden?",{text:"Löschen",icon:b,handler:()=>{p.table("riskassessments").delete(i),p.table("riskassessmentsmeta").delete(i)}})}return(i,l)=>(u(),c(te,null,{default:n(()=>[s(e(z),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:n(()=>[s(e(B),{onClick:l[0]||(l[0]=o=>v())},{default:n(()=>[s(e(r),{icon:e(R)},null,8,["icon"])]),_:1})]),_:1}),(u(!0),L(E,null,$(e(C),o=>(u(),c(e(S),{key:o.id},{default:n(()=>[s(e(T),{onClick:g=>A(o.id)},{default:n(()=>[s(e(F),null,{default:n(()=>[a(f(o.descr),1)]),_:2},1024),s(e(N),null,{default:n(()=>[a("Zuletzt geändert: "+f(new Date(o.lastChange*1e3).toLocaleString("de")),1)]),_:2},1024)]),_:2},1032,["onClick"]),o.id===e(t).id?(u(),c(e(V),{key:0,class:"ion-no-padding"},{default:n(()=>[e(t).company?(u(),c(e(d),{key:0,lines:"none"},{default:n(()=>[s(e(r),{slot:"start",icon:e(j)},null,8,["icon"]),a(" "+f(e(t).company),1)]),_:1})):k("",!0),e(t).jobDescr?(u(),c(e(d),{key:1,lines:"none"},{default:n(()=>[s(e(r),{slot:"start",icon:e(H)},null,8,["icon"]),a(" "+f(e(t).jobDescr),1)]),_:1})):k("",!0),e(t).address?(u(),c(e(d),{key:2,lines:"none"},{default:n(()=>[s(e(r),{slot:"start",icon:e(G)},null,8,["icon"]),a(" "+f(e(t).address),1)]),_:1})):k("",!0),e(t).startDate?(u(),c(e(d),{key:3,lines:"none"},{default:n(()=>[s(e(r),{slot:"start",icon:e(K)},null,8,["icon"]),a(" "+f(e(t).startDate+(e(t).endDate?" - "+e(t).endDate:"")),1)]),_:1})):k("",!0),s(e(d),{lines:"none"},{default:n(()=>[s(e(h),{fill:"clear","router-link":"/riskassessment/".concat(o.id)},{default:n(()=>[a("Bearbeiten")]),_:2},1032,["router-link"]),s(e(h),{fill:"clear",slot:"end",id:"popoverTrigger"+o.id},{default:n(()=>[s(e(r),{icon:e(P)},null,8,["icon"])]),_:2},1032,["id"]),s(e(Q),{trigger:"popoverTrigger"+o.id,"dismiss-on-select":""},{default:n(()=>[s(e(Z),null,{default:n(()=>[s(e(q),{lines:"none"},{default:n(()=>[s(e(d),{id:"titleChangeTrigger"+o.id,button:""},{default:n(()=>[s(e(r),{icon:e(J),slot:"start"},null,8,["icon"]),a(" Beschreibung ändern "),s(e(O),{trigger:"titleChangeTrigger"+o.id,header:"Beschreibung eingeben",buttons:["Abbrechen",{text:"Speichern",handler:D}],inputs:[{placeholder:"Beschreibung",value:o.descr}]},null,8,["trigger","buttons","inputs"])]),_:2},1032,["id"]),s(e(d),{"router-link":"/riskassessment/".concat(o.id,"/export"),button:""},{default:n(()=>[s(e(r),{icon:e(U),slot:"start"},null,8,["icon"]),a(" Exportieren ")]),_:2},1032,["router-link"]),s(e(d),{button:""},{default:n(()=>[s(e(r),{icon:e(W),slot:"start"},null,8,["icon"]),a(" Als Vorlage speichern ")]),_:1}),s(e(d),{button:"",onClick:g=>w(o.id)},{default:n(()=>[s(e(r),{icon:e(X),slot:"start"},null,8,["icon"]),a(" Duplizieren ")]),_:2},1032,["onClick"]),s(e(d),{button:""},{default:n(()=>[s(e(r),{icon:e(Y),slot:"start"},null,8,["icon"]),a(" Archivieren ")]),_:1}),s(e(d),{onClick:g=>I(o.id),button:""},{default:n(()=>[s(e(r),{icon:e(b),slot:"start",color:"danger"},null,8,["icon"]),s(e(M),{color:"danger"},{default:n(()=>[a("Löschen")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["trigger"])]),_:2},1024)]),_:2},1024)):k("",!0)]),_:2},1024))),128))]),_:1}))}});export{me as default};
