import{d as E,x as m,av as F,e as C,u as B,o,c as u,w as a,b as s,f as e,aq as v,i as f,j as i,ar as G,g as p,m as N,n as A,p as D,q as U,F as I,R as x,l as k,G as Z,a6 as b,H as z,T as H,t as g,J as P,aw as W,K as J,I as K,h as Q,r as X,k as L,a as Y,a5 as j,_ as O}from"./index-MjQ2o11G.js";import{u as ee,a as ae}from"./riskassessment-iOSLOJ5G.js";import{_ as se}from"./RiskCatalog.vue_vue_type_script_setup_true_lang-9Q2Q68Te.js";import{G as te}from"./GenericEditModal-zjLK0UkT.js";import{l as V}from"./liveriskstree-ekSLVueQ.js";import{l as ne}from"./livequery-abB8zLye.js";import{_ as re}from"./AddedByList.vue_vue_type_script_setup_true_lang-eAD09o_y.js";import{T as le}from"./TemplateRiskAssessmentPage-mYTbDtK2.js";import{a as oe}from"./helpers-67hrFqte.js";import"./database-Jpx-SvdX.js";import"./index-0jqLegA0.js";const ie={class:"ion-text-right"},ue=E({__name:"RAEditRisks",setup(de){m(0),F(()=>console.log("will enter"));const n=ee(),w=ae(),y=ne.table("measures"),T=C(()=>V.isReady()?w.value.map(r=>({risk:V.get(r),meta:n.getMeta(r)})):[]),d=m("Z");m(-1);const M=C(()=>T.value.filter(r=>r.risk.sector===d.value));["Z","U","A"].includes(B().query.sector)&&(d.value=B().query.sector);const _=m(!1);function S(r){n.risks=n.risks.filter(l=>l!==r.risk.id)}function $(r){oe("Die Gefährdung wirklich aus der Liste entfernen?",{text:"Löschen",role:"destructive",icon:j,handler:()=>{S(r)}})}const q="/riskassessment/"+n.id+"/risks";return(r,l)=>(o(),u(le,null,{default:a(()=>[s(e(G),{value:d.value,onIonChange:l[0]||(l[0]=t=>{d.value=t.detail.value,r.$router.replace({query:{sector:t.detail.value}})})},{default:a(()=>[s(e(v),{value:"Z"},{default:a(()=>[s(e(f),null,{default:a(()=>[i("Zugang")]),_:1})]),_:1}),s(e(v),{value:"U"},{default:a(()=>[s(e(f),null,{default:a(()=>[i("Umgebung")]),_:1})]),_:1}),s(e(v),{value:"A"},{default:a(()=>[s(e(f),null,{default:a(()=>[i("Arbeit")]),_:1})]),_:1})]),_:1},8,["value"]),e(n).ready&&e(y).isReady()?(o(),p(I,{key:0},[s(e(U),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:a(()=>[s(e(N),{onClick:l[1]||(l[1]=t=>_.value=!0)},{default:a(()=>[s(e(A),{icon:e(D)},null,8,["icon"])]),_:1})]),_:1}),(o(!0),p(I,null,x(M.value,t=>(o(),u(e(Z),{key:t.risk.id,class:"risk-card"},{default:a(()=>[s(e(A),{icon:e(b),color:"success",class:"checkmark ion-padding ion-float-right",size:"large"},null,8,["icon"]),s(e(z),null,{default:a(()=>[s(e(H),null,{default:a(()=>{var c,R,h;return[i(g((R=(c=t.risk.factor)==null?void 0:c.category)==null?void 0:R.descr)+" ➤ "+g((h=t.risk.factor)==null?void 0:h.descr),1)]}),_:2},1024),s(e(P),{style:{"font-size":"1.1rem"}},{default:a(()=>[i(g(t.risk.descr),1)]),_:2},1024),e(n).meta[t.risk.id].addedBy.length>0?(o(),u(e(W),{key:0,style:{"margin-bottom":"1rem"}},{default:a(()=>[s(re,{"trigger-list":e(n).meta[t.risk.id].addedBy},null,8,["trigger-list"])]),_:2},1024)):k("",!0)]),_:2},1024),s(e(J),{class:"ion-no-margin ion-no-padding"},{default:a(()=>[e(n).getMeasures(t.risk.id).length?(o(),u(e(K),{key:0,class:"risk-solved ion-no-padding ion-no-margin",lines:"none"},{default:a(()=>[s(e(Q),{class:"ion-no-margin"},{default:a(()=>[s(e(f),null,{default:a(()=>[i("Gewählte Maßnahmen")]),_:1})]),_:1}),(o(!0),p(I,null,x(e(n).getMeasures(t.risk.id),c=>(o(),u(e(X),{class:"ion-no-margin"},{default:a(()=>[i(g(e(y).get(c).descr),1)]),_:2},1024))),256))]),_:2},1024)):k("",!0),Y("div",ie,[e(n).meta[t.risk.id].addedBy.length===0?(o(),u(e(L),{key:0,fill:"clear",color:"danger",onClick:c=>$(t)},{default:a(()=>[i("Löschen")]),_:2},1032,["onClick"])):k("",!0),s(e(L),{fill:"clear","router-link":q+"/"+t.risk.id},{default:a(()=>[i("Bearbeiten")]),_:2},1032,["router-link"])])]),_:2},1024)]),_:2},1024))),128)),s(te,{"is-open":_.value,onWillDismiss:l[3]||(l[3]=t=>_.value=!1),"hide-save":""},{default:a(()=>[s(se,{modelValue:e(n).risks,"onUpdate:modelValue":l[2]||(l[2]=t=>e(n).risks=t),sector:d.value,"link-to-function":()=>{}},null,8,["modelValue","sector"])]),_:1},8,["is-open"])],64)):k("",!0)]),_:1}))}}),he=O(ue,[["__scopeId","data-v-5c08963f"]]);export{he as default};
