System.register(["./TemplateGenericEditPage-legacy-_W9r8IRc.js","./index-legacy-oFp8G8Ab.js","./database-legacy-al1Sa8N6.js","./RiskList.vue_vue_type_script_setup_true_lang-legacy-6xS8dGl9.js","./GenericEditModal-legacy-TXOAvMeS.js","./RiskCatalog.vue_vue_type_script_setup_true_lang-legacy-aGrY8t-z.js","./helpers-legacy-AWkUcU2B.js","./livequery-legacy-5AwHvNjI.js","./RiskListItem-legacy-33kLv0JK.js","./GenericList.vue_vue_type_script_setup_true_lang-legacy-DvdzpM7C.js","./liveriskstree-legacy-bYbQc470.js","./index-legacy-X91ZUWSc.js"],(function(e,t){"use strict";var l,s,i,a,n,u,d,o,r,c,m,p,g,h,f,_,k,v,q,V,b,y,R,I,j,w,T,C,D,S,E,L;return{setters:[e=>{l=e.T},e=>{s=e.d,i=e.e,a=e.o,n=e.g,u=e.b,d=e.f,o=e.s,r=e.F,c=e.R,m=e.a,p=e.c,g=e.w,h=e.t,f=e.j,_=e.aH,k=e.I,v=e.r,q=e.i,V=e.h,b=e.k,y=e._,R=e.v,I=e.l,j=e.u,w=e.S},e=>{T=e.d},e=>{C=e._},e=>{D=e.G},e=>{S=e._},e=>{E=e.p},e=>{L=e.l},null,null,null,null],execute:function(){const t={class:"tag-input"},G=m("br",null,null,-1),$={components:{IonList:k,IonItem:v,IonLabel:q,IonListHeader:V,IonInput:o,RiskList:C,RiskCatalog:S,GenericEditModal:D,IonButton:b,TagInput:s({__name:"TagInput",props:{modelValue:{},allTags:{}},setup(e){const l=e,s=i((()=>{console.log("FOO");const e=new Set([...l.allTags,...l.modelValue]);return console.log(e),[...e]}));return(e,l)=>(a(),n("div",t,[u(d(o),{label:"Tags","label-placement":"floating",modelValue:e.modelValue.join(" "),"onUpdate:modelValue":l[0]||(l[0]=t=>e.$emit("update:modelValue",t.split(" ").map((e=>e.trim().toLowerCase())).filter((e=>""!==e))))},null,8,["modelValue"]),G,(a(!0),n(r,null,c(s.value,(t=>(a(),p(d(_),{outline:!e.modelValue.includes(t),onClick:l=>e.$emit("update:modelValue",e.modelValue.includes(t)?e.modelValue.filter((e=>e!==t)):[...e.modelValue,t])},{default:g((()=>[f(h(t),1)])),_:2},1032,["outline","onClick"])))),256))]))}})},emits:["hasSaved","hasAdded"],props:{id:{type:Number},createNew:Boolean,defaultValues:{type:Object,default:{descr:"",tags:[],causeRisks:[]}}},data:()=>({equipment:void 0,addCausedRisks:!1}),computed:{allTags:()=>L.table("equipment").entries().reduce(((e,t)=>(e.push(...t.tags),e)),[])},methods:{loadFromDb(){void 0!==this.id&&T.equipment.get(this.id).then((e=>{void 0!==e?this.equipment=e:E("Es existiert keine Ausrüstung mit der ID "+this.id+" in der Datenbank.","danger")}))},saveToDb(){if(void 0===this.equipment)return void E("Etwas ist schief gelaufen.");if(""===this.equipment.descr)return void E("Die Beschreibung darf nicht leer sein.");const e={descr:this.equipment.descr,tags:[...this.equipment.tags],causeRisks:[...this.equipment.causeRisks]};this.createNew&&T.equipment.add(e).then((t=>{E(e.descr+" wurde hinzugefügt.","success"),this.$emit("hasAdded",{id:t,...this.equipment})})).catch((e=>{throw E("Beim Speichern ist ein Fehler aufgetreten.","danger"),e})),void 0!==this.id?T.equipment.update(this.id,e).then((()=>{E("Änderungen gespeichert.","success"),console.log(e),this.$emit("hasSaved",{id:this.id,...this.equipment})})).catch((e=>{throw E("Beim Speichern ist ein Fehler aufgetreten.","warning"),e})):E("Ungültige ID","danger")}},mounted(){this.equipment=this.defaultValues,console.log(this.equipment),this.loadFromDb()}},F=y($,[["render",function(e,t,l,s,i,d){const o=R("ion-input"),c=R("ion-item"),m=R("TagInput"),p=R("ion-list"),h=R("ion-label"),_=R("ion-button"),k=R("ion-list-header"),v=R("RiskList"),q=R("RiskCatalog"),V=R("GenericEditModal");return i.equipment?(a(),n(r,{key:0},[u(p,{inset:"",lines:"none"},{default:g((()=>[u(c,null,{default:g((()=>[u(o,{label:"Beschreibung","label-placement":"floating",modelValue:i.equipment.descr,"onUpdate:modelValue":t[0]||(t[0]=e=>i.equipment.descr=e)},null,8,["modelValue"])])),_:1}),u(c,null,{default:g((()=>[u(m,{modelValue:i.equipment.tags,"onUpdate:modelValue":t[1]||(t[1]=e=>i.equipment.tags=e),allTags:d.allTags},null,8,["modelValue","allTags"])])),_:1})])),_:1}),u(v,{modelValue:i.equipment.causeRisks,"onUpdate:modelValue":t[3]||(t[3]=e=>i.equipment.causeRisks=e),"forbid-deletion":"",inverted:"",inset:""},{header:g((()=>[u(k,null,{default:g((()=>[u(h,null,{default:g((()=>[f("Verursachte Gefährdungen...")])),_:1}),u(_,{onClick:t[2]||(t[2]=e=>i.addCausedRisks=!0)},{default:g((()=>[f("Hinzufügen")])),_:1})])),_:1})])),_:1},8,["modelValue"]),u(V,{"is-open":i.addCausedRisks,onWillDismiss:t[5]||(t[5]=e=>i.addCausedRisks=!1),"hide-save":""},{default:g((()=>[u(q,{modelValue:i.equipment.causeRisks,"onUpdate:modelValue":t[4]||(t[4]=e=>i.equipment.causeRisks=e),"link-to-function":()=>{}},null,8,["modelValue"])])),_:1},8,["is-open"])],64)):I("",!0)}]]);e("default",s({__name:"EquipmentEditPage",setup(e){let t,s={descr:"",tags:[],causeRisks:[]},i=!1;const n=j();return"/equipment/new"===n.path?i=!0:t=parseInt(n.params.id),(e,n)=>(a(),p(l,{onShouldCancel:n[2]||(n[2]=t=>e.$router.back()),onSubmit:n[3]||(n[3]=t=>{e.$refs.editor.saveToDb()})},{default:g((()=>[(a(),p(w,null,{default:g((()=>[u(F,{ref:"editor",id:d(t),"create-new":d(i),"default-values":d(s),onHasAdded:n[0]||(n[0]=t=>e.$router.back()),onHasSaved:n[1]||(n[1]=t=>e.$router.back())},null,8,["id","create-new","default-values"])])),_:1}))])),_:1}))}}))}}}));
