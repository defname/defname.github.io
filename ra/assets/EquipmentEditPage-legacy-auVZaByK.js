System.register(["./TemplateGenericEditPage-legacy-ZMO6_N5Y.js","./index-legacy-_V2JG4xb.js","./helpers-legacy-72zI7Q26.js","./RiskList.vue_vue_type_script_setup_true_lang-legacy-qw7FoxWU.js","./GenericEditModal-legacy-9DFang4Y.js","./RiskCatalog.vue_vue_type_script_setup_true_lang-legacy-3ECYpvsE.js","./livequery-legacy-DVuWgej8.js","./RiskListItem-legacy-SzGkzKz6.js","./GenericList.vue_vue_type_script_setup_true_lang-legacy-7Ak10byp.js","./liveriskstree-legacy-psEmqLfo.js","./index-legacy-X91ZUWSc.js"],(function(e,t){"use strict";var l,i,s,a,n,u,d,o,r,c,m,p,g,h,f,_,k,v,q,V,b,y,R,I,j,w,T,C,D,S,E,L;return{setters:[e=>{l=e.T},e=>{i=e.d,s=e.e,a=e.o,n=e.g,u=e.b,d=e.f,o=e.s,r=e.F,c=e.R,m=e.a,p=e.c,g=e.w,h=e.t,f=e.j,_=e.aA,k=e.I,v=e.r,q=e.i,V=e.h,b=e.k,y=e._,R=e.v,I=e.l,j=e.u,w=e.S},e=>{T=e.d,C=e.p},e=>{D=e._},e=>{S=e.G},e=>{E=e._},e=>{L=e.l},null,null,null,null],execute:function(){const t={class:"tag-input"},$=m("br",null,null,-1),B={components:{IonList:k,IonItem:v,IonLabel:q,IonListHeader:V,IonInput:o,RiskList:D,RiskCatalog:E,GenericEditModal:S,IonButton:b,TagInput:i({__name:"TagInput",props:{modelValue:{},allTags:{}},setup(e){const l=e,i=s((()=>{console.log("FOO");const e=new Set([...l.allTags,...l.modelValue]);return console.log(e),[...e]}));return(e,l)=>(a(),n("div",t,[u(d(o),{label:"Tags","label-placement":"floating",modelValue:e.modelValue.join(" "),"onUpdate:modelValue":l[0]||(l[0]=t=>e.$emit("update:modelValue",t.split(" ").map((e=>e.trim().toLowerCase())).filter((e=>""!==e))))},null,8,["modelValue"]),$,(a(!0),n(r,null,c(i.value,(t=>(a(),p(d(_),{outline:!e.modelValue.includes(t),onClick:l=>e.$emit("update:modelValue",e.modelValue.includes(t)?e.modelValue.filter((e=>e!==t)):[...e.modelValue,t])},{default:g((()=>[f(h(t),1)])),_:2},1032,["outline","onClick"])))),256))]))}})},emits:["hasSaved","hasAdded"],props:{id:{type:Number},createNew:Boolean,defaultValues:{type:Object,default:{descr:"",tags:[],causeRisks:[]}}},data:()=>({equipment:void 0,addCausedRisks:!1}),computed:{allTags:()=>L.table("equipment").entries().reduce(((e,t)=>(e.push(...t.tags),e)),[])},methods:{loadFromDb(){void 0!==this.id&&T.equipment.get(this.id).then((e=>{void 0!==e?this.equipment=e:C("Es existiert keine Ausrüstung mit der ID "+this.id+" in der Datenbank.","danger")}))},saveToDb(){if(void 0===this.equipment)return void C("Etwas ist schief gelaufen.");if(""===this.equipment.descr)return void C("Die Beschreibung darf nicht leer sein.");const e={descr:this.equipment.descr,tags:[...this.equipment.tags],causeRisks:[...this.equipment.causeRisks]};this.createNew&&T.equipment.add(e).then((t=>{C(e.descr+" wurde hinzugefügt.","success"),this.$emit("hasAdded",{id:t,...this.equipment})})).catch((e=>{throw C("Beim Speichern ist ein Fehler aufgetreten.","danger"),e})),void 0!==this.id?T.equipment.update(this.id,e).then((()=>{C("Änderungen gespeichert.","success"),console.log(e),this.$emit("hasSaved",{id:this.id,...this.equipment})})).catch((e=>{throw C("Beim Speichern ist ein Fehler aufgetreten.","warning"),e})):C("Ungültige ID","danger")}},mounted(){this.equipment=this.defaultValues,console.log(this.equipment),this.loadFromDb()}},F=y(B,[["render",function(e,t,l,i,s,d){const o=R("ion-input"),c=R("ion-item"),m=R("TagInput"),p=R("ion-list"),h=R("ion-label"),_=R("ion-button"),k=R("ion-list-header"),v=R("RiskList"),q=R("RiskCatalog"),V=R("GenericEditModal");return s.equipment?(a(),n(r,{key:0},[u(p,{inset:"",lines:"none"},{default:g((()=>[u(c,null,{default:g((()=>[u(o,{label:"Beschreibung","label-placement":"floating",modelValue:s.equipment.descr,"onUpdate:modelValue":t[0]||(t[0]=e=>s.equipment.descr=e)},null,8,["modelValue"])])),_:1}),u(c,null,{default:g((()=>[u(m,{modelValue:s.equipment.tags,"onUpdate:modelValue":t[1]||(t[1]=e=>s.equipment.tags=e),allTags:d.allTags},null,8,["modelValue","allTags"])])),_:1})])),_:1}),u(v,{modelValue:s.equipment.causeRisks,"onUpdate:modelValue":t[3]||(t[3]=e=>s.equipment.causeRisks=e),"forbid-deletion":"",inverted:"",inset:""},{header:g((()=>[u(k,null,{default:g((()=>[u(h,null,{default:g((()=>[f("Verursachte Gefährdungen...")])),_:1}),u(_,{onClick:t[2]||(t[2]=e=>s.addCausedRisks=!0)},{default:g((()=>[f("Hinzufügen")])),_:1})])),_:1})])),_:1},8,["modelValue"]),u(V,{"is-open":s.addCausedRisks,onWillDismiss:t[5]||(t[5]=e=>s.addCausedRisks=!1),"hide-save":""},{default:g((()=>[u(q,{modelValue:s.equipment.causeRisks,"onUpdate:modelValue":t[4]||(t[4]=e=>s.equipment.causeRisks=e),"link-to-function":()=>{}},null,8,["modelValue"])])),_:1},8,["is-open"])],64)):I("",!0)}]]);e("default",i({__name:"EquipmentEditPage",setup(e){let t,i={descr:"",tags:[],causeRisks:[]},s=!1;const n=j();return"/equipment/new"===n.path?s=!0:t=parseInt(n.params.id),(e,n)=>(a(),p(l,{onShouldCancel:n[2]||(n[2]=t=>e.$router.back()),onSubmit:n[3]||(n[3]=t=>{e.$refs.editor.saveToDb()})},{default:g((()=>[(a(),p(w,null,{default:g((()=>[u(F,{ref:"editor",id:d(t),"create-new":d(s),"default-values":d(i),onHasAdded:n[0]||(n[0]=t=>e.$router.back()),onHasSaved:n[1]||(n[1]=t=>e.$router.back())},null,8,["id","create-new","default-values"])])),_:1}))])),_:1}))}}))}}}));
