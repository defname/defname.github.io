import{d as x,Q as B,x as T,o as i,c as r,w as t,b as n,f as e,M as L,R as S,T as v,n as a,U as z,i as p,j as o,V as F,W as h,X as V,q as E,p as H,m as N,l as c,g as C,Y as j,F as I,G as q,H as P,J as Q,t as g,Z as U,K as Z,r as u,$ as G,a0 as J,a1 as K,a2 as O,k as y,a3 as W,a4 as X,O as Y,I as M,a5 as ee,a6 as ne,a7 as te,a8 as se,a9 as le,aa as oe,ab as ae,ac as ie}from"./index-6YVP06UH.js";import{d as re}from"./database-GtjOZku2.js";import{u as ue,a as de}from"./riskassessment-hEEgjnB3.js";import{_ as ce}from"./TemplateMainPage.vue_vue_type_script_setup_true_lang-rCc9cXlL.js";import{a as fe}from"./helpers-iJWbSvob.js";import{u as me}from"./livequery-DZoN91kH.js";import"./liveriskstree-dDb20zb1.js";const Ie=x({__name:"RiskAssessmentListPage",setup(ke){B();const d=T("default"),A=me(re.riskassessmentsmeta,(f,k)=>f.where("type").equals(k.value).toArray(),!0,[],[d]),l=ue(),{addNewRiskAssessment:b,duplicateRiskAssessment:D,changeRiskAssessmentMetaDescr:$,changeRiskAssessmentType:_,deleteRiskAssessment:w}=de();function R(f){l.id,l.id!==void 0&&f!==l.id&&l.modified()?fe("In der geöffneten Einsatzplanung gibt es noch ungespeicherte Änderungen. Diese gehen verloren wenn eine andere geöffnet wird. Soll die Einsatzplanung trotzdem geöffnet werden?",{text:"Öffnen",role:"submit",icon:ie,handler:()=>{l.loadFromDb(f)}}):l.loadFromDb(f)}return(f,k)=>(i(),r(ce,null,{footer:t(()=>[n(e(V),null,{default:t(()=>[n(e(L),null,{default:t(()=>[n(e(S),{value:d.value,onIonChange:k[1]||(k[1]=s=>{d.value=s.detail.value,f.$router.replace({query:{segment:s.detail.value}})})},{default:t(()=>[n(e(v),{value:"default"},{default:t(()=>[n(e(a),{icon:e(z)},null,8,["icon"]),n(e(p),null,{default:t(()=>[o("Aktuell")]),_:1})]),_:1}),n(e(v),{value:"preset"},{default:t(()=>[n(e(a),{icon:e(F)},null,8,["icon"]),n(e(p),null,{default:t(()=>[o("Vorlagen")]),_:1})]),_:1}),n(e(v),{value:"archieved"},{default:t(()=>[n(e(a),{icon:e(h)},null,8,["icon"]),n(e(p),null,{default:t(()=>[o("Archiv")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),default:t(()=>[d.value!=="archieved"?(i(),r(e(E),{key:0,slot:"fixed",vertical:"bottom",horizontal:"end"},{default:t(()=>[n(e(N),{onClick:k[0]||(k[0]=s=>d.value==="preset"?e(b)("preset"):e(b)())},{default:t(()=>[n(e(a),{icon:e(H)},null,8,["icon"])]),_:1})]),_:1})):c("",!0),(i(!0),C(I,null,j(e(A),s=>(i(),r(e(q),{key:s.id},{default:t(()=>[n(e(P),{onClick:m=>R(s.id)},{default:t(()=>[n(e(Q),null,{default:t(()=>[o(g(s.descr),1)]),_:2},1024),n(e(U),null,{default:t(()=>[o("Zuletzt geändert: "+g(new Date(s.lastChange*1e3).toLocaleString("de")),1)]),_:2},1024)]),_:2},1032,["onClick"]),s.id===e(l).id?(i(),r(e(Z),{key:0,class:"ion-no-padding"},{default:t(()=>[e(l).company?(i(),r(e(u),{key:0,lines:"none"},{default:t(()=>[n(e(a),{slot:"start",icon:e(G)},null,8,["icon"]),o(" "+g(e(l).company),1)]),_:1})):c("",!0),e(l).jobDescr?(i(),r(e(u),{key:1,lines:"none"},{default:t(()=>[n(e(a),{slot:"start",icon:e(J)},null,8,["icon"]),o(" "+g(e(l).jobDescr),1)]),_:1})):c("",!0),e(l).address?(i(),r(e(u),{key:2,lines:"none"},{default:t(()=>[n(e(a),{slot:"start",icon:e(K)},null,8,["icon"]),o(" "+g(e(l).address),1)]),_:1})):c("",!0),e(l).startDate?(i(),r(e(u),{key:3,lines:"none"},{default:t(()=>[n(e(a),{slot:"start",icon:e(O)},null,8,["icon"]),o(" "+g(e(l).startDate+(e(l).endDate?" - "+e(l).endDate:"")),1)]),_:1})):c("",!0),n(e(u),{lines:"none"},{default:t(()=>[n(e(y),{fill:"clear","router-link":"/riskassessment/".concat(s.id)},{default:t(()=>[o("Bearbeiten")]),_:2},1032,["router-link"]),n(e(y),{fill:"clear",slot:"end",id:"popoverTrigger"+s.id},{default:t(()=>[n(e(a),{icon:e(W)},null,8,["icon"])]),_:2},1032,["id"]),n(e(X),{trigger:"popoverTrigger"+s.id,"dismiss-on-select":""},{default:t(()=>[n(e(Y),null,{default:t(()=>[n(e(M),{lines:"none"},{default:t(()=>[n(e(u),{id:"titleChangeTrigger"+s.id,button:""},{default:t(()=>[n(e(a),{icon:e(ee),slot:"start"},null,8,["icon"]),o(" Beschreibung ändern "),n(e(ne),{trigger:"titleChangeTrigger"+s.id,header:"Beschreibung eingeben",buttons:["Abbrechen",{text:"Speichern",handler:m=>e($)(s.id,m[0])}],inputs:[{placeholder:"Beschreibung",value:s.descr}]},null,8,["trigger","buttons","inputs"])]),_:2},1032,["id"]),d.value!=="archieved"?(i(),C(I,{key:0},[d.value==="default"?(i(),r(e(u),{key:0,"router-link":"/riskassessment/".concat(s.id,"/export"),button:""},{default:t(()=>[n(e(a),{icon:e(te),slot:"start"},null,8,["icon"]),o(" Exportieren ")]),_:2},1032,["router-link"])):c("",!0),d.value!=="preset"?(i(),r(e(u),{key:1,button:"",onClick:m=>e(_)(s.id,"preset")},{default:t(()=>[n(e(a),{icon:e(se),slot:"start"},null,8,["icon"]),o(" In Vorlage umwandeln ")]),_:2},1032,["onClick"])):c("",!0),n(e(u),{button:"",onClick:m=>e(D)(s.id)},{default:t(()=>[n(e(a),{icon:e(le),slot:"start"},null,8,["icon"]),o(" Duplizieren ")]),_:2},1032,["onClick"]),d.value!=="preset"?(i(),r(e(u),{key:2,button:"",onClick:m=>e(_)(s.id,"archieved")},{default:t(()=>[n(e(a),{icon:e(h),slot:"start"},null,8,["icon"]),o(" Archivieren ")]),_:2},1032,["onClick"])):c("",!0)],64)):(i(),r(e(u),{key:1,button:"",onClick:m=>e(_)(s.id,"default")},{default:t(()=>[n(e(a),{icon:e(oe),slot:"start"},null,8,["icon"]),o(" Aus dem Archiv holen ")]),_:2},1032,["onClick"])),n(e(u),{onClick:m=>e(w)(s.id),button:""},{default:t(()=>[n(e(a),{icon:e(ae),slot:"start",color:"danger"},null,8,["icon"]),n(e(p),{color:"danger"},{default:t(()=>[o("Löschen")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["trigger"])]),_:2},1024)]),_:2},1024)):c("",!0)]),_:2},1024))),128))]),_:1}))}});export{Ie as default};
