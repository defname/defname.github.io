import{d as y,Q as A,o as u,c,w as n,b as s,f as e,m as B,n as l,p as R,q as z,g as L,R as $,F as E,G as S,H as T,J as F,t as f,j as a,T as N,K as V,r as d,U as j,l as k,V as H,W as G,X as K,k as h,Y as P,Z as Q,O as Z,I as q,$ as J,a0 as O,a1 as U,a2 as W,a3 as X,a4 as b,i as Y,a5 as M}from"./index-xm7OlJwR.js";import{d as m}from"./database-y4SrtzQs.js";import{u as ee,d as se}from"./riskassessment-2SeHuEkN.js";import{l as p}from"./livequery-oK8gD4FI.js";import{_ as ne}from"./TemplateMainPage.vue_vue_type_script_setup_true_lang-k7MVqf55.js";import{a as _}from"./helpers-IDuM_-et.js";import"./liveriskstree-OUGTu9yV.js";const ce=y({__name:"RiskAssessmentListPage",setup(te){A();const C=p.table("riskassessmentsmeta").entries(),t=ee();function v(){m.riskassessments.add({...se}).then(o=>{const r=Math.floor(Date.now()/1e3);m.riskassessmentsmeta.add({id:o,descr:"Neue Gefährdungsbeurteilung "+o,created:r,lastChange:r}).then(()=>{})})}async function w(o){return m.riskassessments.get(o).then(r=>{if(r===void 0)throw Error("riskassessment "+o+" canno be duplicated, since it does not exist in the database");return delete r.id,m.riskassessments.add(r)}).then(r=>m.riskassessmentsmeta.get(o).then(i=>{if(i===void 0)throw Error("riskassessmentMeta for riskassessment "+o+" not found in database.");const g=Math.floor(Date.now()/1e3);return m.riskassessmentsmeta.add({id:r,descr:"Kopie von "+i.descr,created:g,lastChange:g})}))}function D(o){if(t.id!==void 0)return m.riskassessmentsmeta.update(t.id,{descr:o[0]})}function I(o){t.id,t.id!==void 0&&o!==t.id&&t.modified()?_("In der geöffneten Einsatzplanung gibt es noch ungespeicherte Änderungen. Diese gehen verloren wenn eine andere geöffnet wird. Soll die Einsatzplanung trotzdem geöffnet werden?",{text:"Öffnen",role:"submit",icon:M,handler:()=>{t.loadFromDb(o)}}):t.loadFromDb(o)}function x(o){_("Soll der Einsatzplan wirklich unwideruflich gelöscht werden?",{text:"Löschen",icon:b,handler:()=>{p.table("riskassessments").delete(o),p.table("riskassessmentsmeta").delete(o)}})}return(o,r)=>(u(),c(ne,null,{default:n(()=>[s(e(z),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:n(()=>[s(e(B),{onClick:r[0]||(r[0]=i=>v())},{default:n(()=>[s(e(l),{icon:e(R)},null,8,["icon"])]),_:1})]),_:1}),(u(!0),L(E,null,$(e(C),i=>(u(),c(e(S),{key:i.id},{default:n(()=>[s(e(T),{onClick:g=>I(i.id)},{default:n(()=>[s(e(F),null,{default:n(()=>[a(f(i.descr),1)]),_:2},1024),s(e(N),null,{default:n(()=>[a("Zuletzt geändert: "+f(new Date(i.lastChange*1e3).toLocaleString("de")),1)]),_:2},1024)]),_:2},1032,["onClick"]),i.id===e(t).id?(u(),c(e(V),{key:0,class:"ion-no-padding"},{default:n(()=>[e(t).company?(u(),c(e(d),{key:0,lines:"none"},{default:n(()=>[s(e(l),{slot:"start",icon:e(j)},null,8,["icon"]),a(" "+f(e(t).company),1)]),_:1})):k("",!0),e(t).jobDescr?(u(),c(e(d),{key:1,lines:"none"},{default:n(()=>[s(e(l),{slot:"start",icon:e(H)},null,8,["icon"]),a(" "+f(e(t).jobDescr),1)]),_:1})):k("",!0),e(t).address?(u(),c(e(d),{key:2,lines:"none"},{default:n(()=>[s(e(l),{slot:"start",icon:e(G)},null,8,["icon"]),a(" "+f(e(t).address),1)]),_:1})):k("",!0),e(t).startDate?(u(),c(e(d),{key:3,lines:"none"},{default:n(()=>[s(e(l),{slot:"start",icon:e(K)},null,8,["icon"]),a(" "+f(e(t).startDate+(e(t).endDate?" - "+e(t).endDate:"")),1)]),_:1})):k("",!0),s(e(d),{lines:"none"},{default:n(()=>[s(e(h),{fill:"clear","router-link":"/riskassessment/".concat(i.id)},{default:n(()=>[a("Bearbeiten")]),_:2},1032,["router-link"]),s(e(h),{fill:"clear",slot:"end",id:"popoverTrigger"+i.id},{default:n(()=>[s(e(l),{icon:e(P)},null,8,["icon"])]),_:2},1032,["id"]),s(e(Q),{trigger:"popoverTrigger"+i.id,"dismiss-on-select":""},{default:n(()=>[s(e(Z),null,{default:n(()=>[s(e(q),{lines:"none"},{default:n(()=>[s(e(d),{id:"titleChangeTrigger"+i.id,button:""},{default:n(()=>[s(e(l),{icon:e(J),slot:"start"},null,8,["icon"]),a(" Beschreibung ändern "),s(e(O),{trigger:"titleChangeTrigger"+i.id,header:"Beschreibung eingeben",buttons:["Abbrechen",{text:"Speichern",handler:D}],inputs:[{placeholder:"Beschreibung",value:i.descr}]},null,8,["trigger","buttons","inputs"])]),_:2},1032,["id"]),s(e(d),{"router-link":"/riskassessment/".concat(i.id,"/export"),button:""},{default:n(()=>[s(e(l),{icon:e(U),slot:"start"},null,8,["icon"]),a(" Exportieren ")]),_:2},1032,["router-link"]),s(e(d),{button:""},{default:n(()=>[s(e(l),{icon:e(W),slot:"start"},null,8,["icon"]),a(" Als Vorlage speichern ")]),_:1}),s(e(d),{button:"",onClick:g=>w(i.id)},{default:n(()=>[s(e(l),{icon:e(X),slot:"start"},null,8,["icon"]),a(" Duplizieren ")]),_:2},1032,["onClick"]),s(e(d),{onClick:g=>x(i.id),button:""},{default:n(()=>[s(e(l),{icon:e(b),slot:"start",color:"danger"},null,8,["icon"]),s(e(Y),{color:"danger"},{default:n(()=>[a("Löschen")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["trigger"])]),_:2},1024)]),_:2},1024)):k("",!0)]),_:2},1024))),128))]),_:1}))}});export{ce as default};
