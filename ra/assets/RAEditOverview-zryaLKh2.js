import{d as S,o as l,c as d,f as e,ac as L,n as c,_ as G,x as P,g as r,b as n,s as x,w as s,ad as O,ae as N,k as T,af as Q,I as E,F as m,Y as z,ag as U,r as k,i as D,t as w,j as i,ah as K,ai as Y,ab as Z,aj as J,e as q,ak as X,al as ee,am as ne,O as te,a4 as se,h as F,$ as le,l as y,a0 as ae,a1 as oe,a2 as ie,an as re,ao as ue,ap as de,aq as ce,ar as me}from"./index-6YVP06UH.js";import{u as W,b as fe}from"./riskassessment-hEEgjnB3.js";import{u as ke,l as M}from"./livequery-DZoN91kH.js";import{T as pe}from"./TemplateRiskAssessmentPage-axdKbpF4.js";import{G as B}from"./GenericEditModal-Dq9AzYfS.js";import{u as ge,a as _e,_ as ve}from"./HistoryTextarea.vue_vue_type_script_setup_true_lang-a9_zLHQ5.js";import{d as j}from"./database-GtjOZku2.js";import"./liveriskstree-dDb20zb1.js";import"./helpers-iJWbSvob.js";import"./index-0jqLegA0.js";import"./index-9UN-Ox_G.js";const ye=S({__name:"Checkmark",setup(R){return(h,C)=>(l(),d(e(c),{class:"checkmark",slot:"end",color:"success",icon:e(L)},null,8,["icon"]))}}),I=G(ye,[["__scopeId","data-v-b74799a7"]]),he=S({__name:"HistoryInput",props:{modelValue:{},label:{},inputId:{}},emits:["update:modelValue"],setup(R,{emit:h}){const C=h,A=R,t=ge(A.inputId),$=P(void 0),V=P(!1),a=P(""),{results:f}=_e(a,t.entries,{matchAllWhenSearchEmpty:!0});function p(o){o.detail.role==="save"&&(C("update:modelValue",a.value),t.add(a.value)),V.value=!1}function g(){a.value=A.modelValue}function b(o){return t.remove(o)}function u(o){a.value=o,$.value.$el.setFocus()}return(o,_)=>(l(),r(m,null,[n(e(x),{label:o.label,"label-placement":"floating",value:o.modelValue,onClick:_[0]||(_[0]=v=>V.value=!0)},null,8,["label","value"]),n(B,{"is-open":V.value,onWillDismiss:p,onDidPresent:_[4]||(_[4]=v=>$.value.$el.setFocus()),onWillPresent:g,"icon-save":e(L)},{default:s(()=>[n(e(x),{ref_key:"input",ref:$,label:o.label,"label-placement":"stacked",modelValue:a.value,"onUpdate:modelValue":_[2]||(_[2]=v=>a.value=v),onKeydown:_[3]||(_[3]=O(N(v=>u(e(f)[0].item),["prevent"]),["tab"]))},{default:s(()=>[n(e(T),{slot:"end",fill:"clear",onClick:_[1]||(_[1]=v=>{console.log(a.value,o.modelValue),a.value=o.modelValue})},{default:s(()=>[n(e(c),{slot:"icon-only",icon:e(Q)},null,8,["icon"])]),_:1})]),_:1},8,["label","modelValue"]),n(e(E),{ref:"slidingList"},{default:s(()=>[(l(!0),r(m,null,z(e(f),(v,$e)=>(l(),d(e(U),{key:v.item,ref_for:!0,ref:"slidingItem"},{default:s(()=>[n(e(k),{onClick:H=>u(v.item)},{default:s(()=>[n(e(D),null,{default:s(()=>[i(w(v.item),1)]),_:2},1024)]),_:2},1032,["onClick"]),n(e(K),{side:"end"},{default:s(()=>[n(e(Y),{color:"danger",onClick:H=>b(v.item)},{default:s(()=>[n(e(c),{icon:e(Z),slot:"end"},null,8,["icon"]),i(" Löschen ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},512)]),_:1},8,["is-open","icon-save"])],64))}}),be=S({__name:"AddPresetsModal",setup(R){const h=P(0),C=W(),A=ke(j.riskassessmentsmeta,a=>a.where("type").equals("preset").toArray(),!0,[],[h]),t=new Set;function $(a){a.detail.role==="save"&&j.riskassessments.bulkGet(Array.from(t)).then(f=>{f.forEach(p=>p&&C.mergePreset(p))})}function V(a,f){a.detail.checked?t.add(f):t.delete(f)}return(a,f)=>(l(),d(B,{title:"Vorlagen auswählen","icon-save":e(L),onWillPresent:f[0]||(f[0]=p=>h.value++),onWillDismiss:$},{default:s(()=>[n(e(E),null,{default:s(()=>[(l(!0),r(m,null,z(e(A),p=>(l(),d(e(k),{key:p.id},{default:s(()=>[n(e(J),{onIonChange:g=>V(g,p.id),justify:"space-between"},{default:s(()=>[i(w(p.descr),1)]),_:2},1032,["onIonChange"])]),_:2},1024))),128))]),_:1})]),_:1},8,["icon-save"]))}}),Ie={key:1,class:"nested-list",lines:"none"},Ve={class:"ion-no-padding ion-no-margin nested-list-item",lines:"none"},we={key:1,class:"nested-list ion-no-padding",lines:"none"},Ce={class:"ion-no-padding ion-no-margin nested-list-item",lines:"none",size:"small"},Ae=S({__name:"RAEditOverview",setup(R){const h=P(!1),C=M.table("technicians"),A=M.table("equipment"),t=W(),$=q(()=>C.isReady().value?t.technicians.map(b=>C.get(b)):[]),V=q(()=>A.isReady().value?t.equipment.map(b=>A.get(b)):[]),a="/riskassessment/"+t.id,f=P(0),p=fe(),g=X({direct:-1,all:-1,solved:-1});return ee([p],async()=>{await t.ready,g.direct=t.risks.length;const b=await t.calcAllRisks();g.all=b.length,g.solved=b.filter(u=>t.measures[u]!==void 0&&t.measures[u].length>0).length}),q(()=>t.changes()),(b,u)=>(l(),d(pe,null,{moreButtons:s(()=>[n(e(T),{strong:!0,id:"riskassessment-submenu-button"},{default:s(()=>[n(e(c),{icon:e(ne),slot:"icon-only"},null,8,["icon"])]),_:1}),n(e(se),{trigger:"riskassessment-submenu-button","dismiss-on-select":""},{default:s(()=>[n(e(te),null,{default:s(()=>[n(e(E),{lines:"none"},{default:s(()=>[n(e(k),{button:"",onClick:u[0]||(u[0]=o=>h.value=!0)},{default:s(()=>[i(" Vorlage hinzugügen ")]),_:1})]),_:1})]),_:1})]),_:1})]),default:s(()=>[n(be,{"is-open":h.value,onWillDismiss:u[1]||(u[1]=o=>{h.value=!1,f.value++})},null,8,["is-open"]),n(e(E),{lines:"full"},{default:s(()=>[n(e(F),null,{default:s(()=>[i(" Allgemeines ")]),_:1}),n(e(k),null,{default:s(()=>[n(e(c),{slot:"start",icon:e(le)},null,8,["icon"]),e(t).company?(l(),d(I,{key:0})):y("",!0),n(he,{modelValue:e(t).company,"onUpdate:modelValue":u[2]||(u[2]=o=>e(t).company=o),"input-id":"ra_company",label:"Ausführende Firma"},null,8,["modelValue"])]),_:1}),n(e(k),null,{default:s(()=>[n(e(c),{slot:"start",icon:e(ae)},null,8,["icon"]),e(t).jobDescr?(l(),d(I,{key:0})):y("",!0),n(ve,{label:"Beschreibung der Tätigkeit","input-id":"ra_jobdescr",modelValue:e(t).jobDescr,"onUpdate:modelValue":u[3]||(u[3]=o=>e(t).jobDescr=o)},null,8,["modelValue"])]),_:1}),n(e(k),null,{default:s(()=>[n(e(c),{slot:"start",icon:e(oe)},null,8,["icon"]),e(t).address?(l(),d(I,{key:0})):y("",!0),n(e(x),{"router-link":a+"/location",label:"Addresse","label-placement":"floating",readonly:"",value:e(t).address},null,8,["router-link","value"])]),_:1}),n(e(k),null,{default:s(()=>[n(e(c),{slot:"start",icon:e(ie)},null,8,["icon"]),e(t).startDate?(l(),d(I,{key:0})):y("",!0),n(e(x),{"router-link":a+"/date",label:"Datum","label-placement":"floating",readonly:"",value:e(t).startDate+(e(t).endDate?" - "+e(t).endDate:"")},null,8,["router-link","value"])]),_:1}),n(e(k),{"router-link":a+"/equipment",detail:!1},{default:s(()=>[n(e(c),{slot:"start",icon:e(re)},null,8,["icon"]),e(t).equipment?(l(),d(I,{key:0})):y("",!0),n(e(D),{position:"stacked",style:{"z-index":"10"},class:"label"},{default:s(()=>[i("Ausrüstung")]),_:1}),V.value.length>0?(l(),r("ul",Ie,[(l(!0),r(m,null,z(V.value,o=>(l(),r("li",Ve,w(o.descr),1))),256))])):y("",!0)]),_:1},8,["router-link"]),n(e(k),{"router-link":a+"/technicians",detail:!1},{default:s(()=>[n(e(c),{slot:"start",icon:e(ue)},null,8,["icon"]),e(t).technicians.length>0?(l(),d(I,{key:0})):y("",!0),n(e(D),{position:"stacked",style:{"z-index":"10"},class:"label"},{default:s(()=>[i("Personal")]),_:1}),e(t).technicians.length>0?(l(),r("ul",we,[(l(!0),r(m,null,z($.value,o=>(l(),r("li",Ce,w(o.name),1))),256))])):(l(),r(m,{key:2},[i(" Es wurde noch kein Personal ausgewählt ")],64))]),_:1},8,["router-link"]),n(e(F),null,{default:s(()=>[i(" Zugang ")]),_:1}),n(e(k),{"router-link":a+"/access",detail:!1},{default:s(()=>[n(e(c),{slot:"start",icon:e(de)},null,8,["icon"]),e(t).access.length>0?(l(),d(I,{key:0})):y("",!0),n(e(D),{position:"stacked",style:{"z-index":"10"},class:"label"},{default:s(()=>[i("Sektoren")]),_:1}),e(t).access.length===0?(l(),r(m,{key:1},[i("Es wurden noch keine Sektoren definiert")],64)):e(t).access.length===1?(l(),r(m,{key:2},[i("Es wurde ein Sektor definiert")],64)):(l(),r(m,{key:3},[i("Es wurden bisher "+w(e(t).access.length)+" Sektoren definiert",1)],64))]),_:1},8,["router-link"]),n(e(k),{"router-link":a+"/rescue",detail:!1},{default:s(()=>[n(e(c),{slot:"start",icon:e(ce)},null,8,["icon"]),e(t).access.length>0?(l(),d(I,{key:0})):y("",!0),n(e(D),{position:"stacked",style:{"z-index":"10"},class:"label"},{default:s(()=>[i("Rettungskonzept")]),_:1}),e(t).access.length===0?(l(),r(m,{key:1},[i("Es wurden noch keine Sektoren definiert")],64)):(l(),r(m,{key:2},[i("Für "+w(e(t).access.filter(o=>o.rescue).length)+" Sektoren existiert ein Rettungskonzept",1)],64))]),_:1},8,["router-link"]),n(e(F),null,{default:s(()=>[i(" Gefährdungen ")]),_:1}),n(e(k),{"router-link":a+"/risks",detail:!1},{default:s(()=>[n(e(c),{slot:"start",icon:e(me)},null,8,["icon"]),e(t).access.length>0?(l(),d(I,{key:0})):y("",!0),n(e(D),{position:"stacked",style:{"z-index":"10"},class:"label"},{default:s(()=>[i("Gefährdungen")]),_:1}),g.all===0?(l(),r(m,{key:1},[i("Es wurden noch keine Gefährdungen hinzugefügt")],64)):(l(),r(m,{key:2},[i(" Von insgesamt "+w(g.all)+" Gefährdungen sind für "+w(g.solved)+" Maßnahmen angegeben. ",1)],64))]),_:1},8,["router-link"])]),_:1})]),_:1}))}}),je=G(Ae,[["__scopeId","data-v-b50c37a5"]]);export{je as default};
