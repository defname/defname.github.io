import{s as v,q as _,h as E,I as $,C as x,H as D,J as k,K as y,L as B,M as A,N as C,j as g,_ as b,D as s,o as w,f as G,a as n,w as o,F as M,i as m,t as P,z as U,r as z,x as H,A as q,O as K,c as O}from"./index-pK9Jxw9y.js";import{T as j}from"./TemplateGenericEditPage-rtNOckVj.js";import{d as f,p as l}from"./helpers-_vyyZU2O.js";import{G as J}from"./GenericEditModal--GkTMFHi.js";const R={components:{IonButtons:v,IonItem:_,IonLabel:E,IonList:$,IonInput:x,IonGrid:D,IonRow:k,IonCol:y,IonSelect:B,IonSelectOption:A,IonTextarea:C,IonButton:g,GenericEditModalVue:J},emits:["hasSaved","hasAdded"],props:{technicianId:Number,createNew:Boolean},data(){return{name:"",fisatId:"",comment:"",fisatLevel:"",modified:!1,technicianData:void 0}},methods:{loadFromDb(t){t!==void 0&&f.technicians.get(t).then(e=>{if(e===void 0){l("Es exisitert kein Mitarbeiter mit der ID ".concat(t," in der Datenbank"),"danger");return}this.technicianData=e,this.resetForm(e)}).catch(e=>{console.log(e)})},resetForm(t=void 0){if(t===void 0){this.name="",this.fisatId="",this.fisatLevel="1",this.comment="";return}this.name=t.name,t.fisat?(this.fisatId=t.fisat.id,this.fisatLevel=""+t.fisat.level):(this.fisatId="",this.fisatLevel="1"),this.comment=t.comment?t.comment:""},async saveToDb(){if(this.technicianId===void 0&&!this.createNew)return;let t={name:this.name};if(this.name==="")return l("Es muss ein Name angegeben werden","danger"),!1;if(this.fisatId!==""){let e=parseInt(this.fisatLevel);if(![1,2,3].includes(e))return l("Ungültiges FISAT Level: "+e,"danger"),!1;t.fisat={id:this.fisatId,level:e}}this.comment!==""&&(t.comment=this.comment),this.createNew?f.technicians.add(t).then(e=>(this.modified=!1,l("Angestellter hinzugefügt","success"),this.$emit("hasAdded",{id:e,...t}),!0)).catch(e=>{throw l("Beim Speichern ist ein Fehler aufgetreten","danger"),e}):f.technicians.update(this.technicianId,t).then(()=>(this.modified=!1,l("Änderungen gespeichert","success"),this.$emit("hasSaved",{id:this.technicianId,...t}),!0)).catch(e=>{throw l("Beim Speichern ist ein Fehler aufgetreten","danger"),e})}},mounted(){this.createNew?this.resetForm():this.loadFromDb(this.technicianId)},watch:{createNew(t){t&&this.resetForm()},technicianId(t){this.createNew||this.loadFromDb(t)}}};function Q(t,e,N,T,i,h){const c=s("ion-label"),r=s("ion-item"),d=s("ion-input"),p=s("ion-col"),u=s("ion-select-option"),L=s("ion-select"),V=s("ion-row"),F=s("ion-grid"),I=s("ion-list"),S=s("ion-textarea");return w(),G(M,null,[n(I,{inset:!0},{default:o(()=>[n(r,{lines:"none"},{default:o(()=>[n(c,{color:"secondary",style:{"font-size":"130%","font-weight":"bold"}},{default:o(()=>[m(P(i.technicianData?i.technicianData.name:"Neuer Mitarbeiter"),1)]),_:1})]),_:1}),n(r,null,{default:o(()=>[n(d,{onIonInput:e[0]||(e[0]=a=>i.modified=!0),label:"Name","label-placement":"floating",placeholder:"Name des Mitarbeiters",modelValue:i.name,"onUpdate:modelValue":e[1]||(e[1]=a=>i.name=a),required:""},null,8,["modelValue"])]),_:1}),n(r,null,{default:o(()=>[n(F,{style:{padding:"0"}},{default:o(()=>[n(V,null,{default:o(()=>[n(p,{style:{padding:"0"}},{default:o(()=>[n(d,{onIonInput:e[2]||(e[2]=a=>i.modified=!0),label:"FISAT-Nr.","label-placement":"floating",modelValue:i.fisatId,"onUpdate:modelValue":e[3]||(e[3]=a=>i.fisatId=a)},null,8,["modelValue"])]),_:1}),n(p,{size:"auto",style:{padding:"0"}},{default:o(()=>[n(L,{onIonInput:e[4]||(e[4]=a=>i.modified=!0),style:{width:"100px"},modelValue:i.fisatLevel,"onUpdate:modelValue":e[5]||(e[5]=a=>i.fisatLevel=a),label:"Level","label-placement":"floating"},{default:o(()=>[n(u,{value:"1"},{default:o(()=>[m("Level 1")]),_:1}),n(u,{value:"2"},{default:o(()=>[m("Level 2")]),_:1}),n(u,{value:"3"},{default:o(()=>[m("Level 3")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(I,{inset:""},{default:o(()=>[n(r,null,{default:o(()=>[n(S,{onIonInput:e[6]||(e[6]=a=>i.modified=!0),label:"Kommentar","label-placement":"floating",rows:5,modelValue:i.comment,"onUpdate:modelValue":e[7]||(e[7]=a=>i.comment=a)},null,8,["modelValue"])]),_:1})]),_:1})],64)}const W=b(R,[["render",Q]]),X={components:{IonHeader:U,IonToolbar:z,IonButtons:v,IonTitle:H,IonItem:_,IonContent:q,IonButton:g,IonModal:K,TemplateGenericEditPage:j,TechnicianEditor:W},emits:["shouldSave","shouldCancel","willPresent"],props:{},data(){return{technicianId:void 0,createNew:!1}},methods:{saveToDb(){this.$refs.editor.saveToDb()}},mounted(){this.$route.path==="/technicians/new"?(this.technicianId=void 0,this.createNew=!0):(this.technicianId=parseInt(this.$route.params.id),this.createNew=!1)}};function Y(t,e,N,T,i,h){const c=s("TechnicianEditor"),r=s("TemplateGenericEditPage");return w(),O(r,{onSubmit:e[2]||(e[2]=d=>h.saveToDb()),onShouldCancel:e[3]||(e[3]=d=>t.$router.back())},{default:o(()=>[n(c,{ref:"editor","technician-id":i.technicianId,"create-new":i.createNew,onHasSaved:e[0]||(e[0]=d=>t.$router.back()),onHasAdded:e[1]||(e[1]=d=>t.$router.back())},null,8,["technician-id","create-new"])]),_:1})}const ie=b(X,[["render",Y]]);export{ie as default};
