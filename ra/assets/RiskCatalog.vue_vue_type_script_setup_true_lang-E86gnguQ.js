import{_ as Y,t as A,d as J,G as K,e as F,o as l,g as p,b as a,f as e,ak as M,c as u,w as n,F as k,V as $,al as P,l as y,am as Q,r as G,n as v,an as N,i as B,j as f,I as X,ao as ee,ap as te,aq as ne,ar as ae,ah as se,as as T,at as I,p as oe,au as le,Y as E,z as re,av as ie,aw as ue,ax as ce,ay as de,az as fe,aA as me,aB as he,aC as ve,aD as ge,aE as be,aF as pe}from"./index-aPl9jvQn.js";import{S as g,d as w,R as L,a as ke,p as C}from"./helpers-1szQ4hrZ.js";import{l as ye}from"./liveriskstree-XvMKZMrI.js";const Ie={props:{sector:{type:String,required:!0},short:Boolean},computed:{asString(){return this.sector===g.Access?this.short?"Z":"Zugang":this.sector===g.Environment?this.short?"U":"Umgebung":this.sector===g.Work?this.short?"A":"Arbeit":(console.warn("Unknown sector"),this.short?"?":"???")}}};function we(s,_,c,S,b,x){return A(x.asString)}const Ce=Y(Ie,[["render",we]]),Ve=J({__name:"RiskCatalog",props:{sector:String,modelValue:Array,exclude:Array,inverted:Boolean,linkToFunction:{type:Function,default:s=>"/risks/".concat(s.id)}},emits:["update:modelValue"],setup(s,{emit:_}){const c=s,S=_,b={},x=[{text:"Abbrechen",role:"cancel"},{text:"Speichern",role:"submit"}],V=ye,i=K(),R=F(()=>{if(i.value!==void 0)return V.get(i.value)}),O=F(()=>R.value?R.value.descr:""),U={1:ie,2:ue,3:ce,4:de,5:fe,6:me,7:he,8:ve,9:ge,10:be,11:N};async function q(t){if(c.sector===void 0)(async()=>{await(await pe.create({header:"Neue Gefährdung",message:"In welchem Sektor besteht die Gefährung?",inputs:[{type:"radio",label:"Zugang",value:g.Access},{type:"radio",label:"Umgebung",value:g.Environment},{type:"radio",label:"Arbeit",value:g.Work}],buttons:[{text:"Abbrechen",role:"cancel"},{text:"Hinzufügen",role:"submit",handler:d=>w.risks.add(new L("Neue Gefährdung",d,t))}]})).present()})();else{const r=c.sector;return w.risks.add(new L("Neue Gefährdung",r,t))}}async function z(t){w.risks.where("id").equals(t).delete().then(()=>{C("Gefährdung wurde aus der Datenbank gelöscht","success")}).catch(r=>{console.log(r)})}async function Z(t){if(t.id===void 0)return;const r={text:"Löschen",role:"destructive",icon:E,handler:j(t.id)};b[t.id]!==null&&b[t.id].$el.close(),await ke("'".concat(t.descr,"' wirklich aus der Datenbank löschen?"),r)}function j(t){return()=>{z(t)}}function D(t){t===void 0||c.modelValue===void 0||(c.modelValue.includes(t)?S("update:modelValue",c.modelValue.filter(r=>r!==t)):S("update:modelValue",[...c.modelValue,t]))}async function W(t,r){if(r===""){C("Die Beschreibung darf nicht leer sein!","danger");return}w.risks.update(t,{descr:r}).then(()=>{C("Änderungen gespeichert","success")}).catch(()=>{C("Beim Speichern ist ein Fehler aufgetreten","danger")})}async function H(t){if(i.value!==void 0){if(b[i.value].$el.close(),t.detail.role!="submit"){i.value=void 0;return}W(i.value,t.detail.data.values[0]),i.value=void 0}}return(t,r)=>(l(),p(k,null,[a(e(M),{isOpen:i.value!==void 0,header:"Beschreibung eingeben",buttons:x,inputs:[{placeholder:"Beschreibung",value:O.value}],"backdrop-dismiss":!0,onDidDismiss:H},null,8,["isOpen","inputs"]),e(V)?(l(),u(e(P),{key:0},{default:n(()=>[(l(!0),p(k,null,$(e(V).categories,m=>(l(),u(e(Q),{key:m.id},{default:n(()=>[a(e(G),{slot:"header"},{default:n(()=>[a(e(v),{slot:"start",icon:m.id?U[m.id]:e(N)},null,8,["icon"]),a(e(B),null,{default:n(()=>[f(A(m.descr),1)]),_:2},1024)]),_:2},1024),a(e(X),{slot:"content"},{default:n(()=>[(l(!0),p(k,null,$(m.factors,d=>(l(),u(e(ee),{key:d.id},{default:n(()=>[a(e(te),null,{default:n(()=>[a(e(B),null,{default:n(()=>[f(A(d.descr),1)]),_:2},1024),d.id?(l(),u(e(v),{key:0,slot:"end",icon:e(ne),color:"primary",onClick:o=>q(d.id)},null,8,["icon","onClick"])):y("",!0)]),_:2},1024),(l(!0),p(k,null,$(d.risks,o=>(l(),p(k,{key:o.id},[(s.exclude===void 0||!s.exclude.includes(o.id))&&(s.modelValue===void 0||s.modelValue.includes(o.id)===s.inverted)&&(!s.sector||o.sector===s.sector)?(l(),u(e(ae),{key:0,ref_for:!0,ref:h=>b[o.id]=h},{default:n(()=>[a(e(G),{"router-link":s.linkToFunction(o)},{default:n(()=>[a(e(B),null,{default:n(()=>[f(A(o.descr),1)]),_:2},1024),s.sector?y("",!0):(l(),u(e(se),{key:0,slot:"end"},{default:n(()=>[a(Ce,{sector:o.sector},null,8,["sector"])]),_:2},1024))]),_:2},1032,["router-link"]),s.modelValue!==void 0?(l(),u(e(T),{key:0,side:"start",onIonSwipe:h=>D(o.id)},{default:n(()=>[s.inverted?(l(),u(e(I),{key:1,color:"warning",onClick:h=>D(o.id),expandable:""},{default:n(()=>[a(e(v),{icon:e(le),slot:"start"},null,8,["icon"]),f(" Enfernen ")]),_:2},1032,["onClick"])):(l(),u(e(I),{key:0,color:"success",onClick:h=>D(o.id),expandable:""},{default:n(()=>[a(e(v),{icon:e(oe),slot:"start"},null,8,["icon"]),f(" Auswählen ")]),_:2},1032,["onClick"]))]),_:2},1032,["onIonSwipe"])):y("",!0),a(e(T),{side:"end"},{default:n(()=>[a(e(I),{color:"danger",onClick:h=>Z(o)},{default:n(()=>[a(e(v),{icon:e(E),slot:"end"},null,8,["icon"]),f(" Löschen ")]),_:2},1032,["onClick"]),a(e(I),{onClick:h=>i.value=o.id},{default:n(()=>[a(e(v),{icon:e(re),slot:"end"},null,8,["icon"]),f(" Bearbeiten ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1536)):y("",!0)],64))),128))]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):y("",!0)],64))}});export{Ve as _};
