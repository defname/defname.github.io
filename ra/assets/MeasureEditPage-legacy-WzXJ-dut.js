System.register(["./TemplateGenericEditPage-legacy-_W9r8IRc.js","./index-legacy-oFp8G8Ab.js","./database-legacy-al1Sa8N6.js","./RiskList.vue_vue_type_script_setup_true_lang-legacy-6xS8dGl9.js","./GenericEditModal-legacy-TXOAvMeS.js","./RiskCatalog.vue_vue_type_script_setup_true_lang-legacy-aGrY8t-z.js","./helpers-legacy-AWkUcU2B.js","./RiskListItem-legacy-33kLv0JK.js","./GenericList.vue_vue_type_script_setup_true_lang-legacy-DvdzpM7C.js","./liveriskstree-legacy-bYbQc470.js","./livequery-legacy-5AwHvNjI.js","./index-legacy-X91ZUWSc.js"],(function(e,s){"use strict";var i,a,t,l,d,u,n,r,o,c,m,h,v,f,k,g,p,_,R,y,b,V,j,I,S,w;return{setters:[e=>{i=e.T},e=>{a=e.I,t=e.r,l=e.i,d=e.h,u=e.s,n=e.k,r=e._,o=e.v,c=e.o,m=e.g,h=e.b,v=e.w,f=e.j,k=e.F,g=e.l,p=e.d,_=e.u,R=e.c,y=e.S,b=e.f},e=>{V=e.d},e=>{j=e._},e=>{I=e.G},e=>{S=e._},e=>{w=e.p},null,null,null,null,null],execute:function(){const s={components:{IonList:a,IonItem:t,IonLabel:l,IonListHeader:d,IonInput:u,RiskList:j,RiskCatalog:S,GenericEditModal:I,IonButton:n},emits:["hasSaved","hasAdded"],props:{id:{type:Number},createNew:Boolean,defaultValues:{type:Object,default:{descr:"",solveRisks:[],causeRisks:[]}}},data:()=>({measure:void 0,addSolvedRisks:!1,addCausedRisks:!1}),methods:{loadFromDb(){void 0!==this.id&&V.measures.get(this.id).then((e=>{void 0!==e?this.measure=e:w("Es existiert keine Maßnahme mit der ID "+this.id+" in der Datenbank.","danger")}))},saveToDb(){var e,s;if(""===(null===(e=this.measure)||void 0===e?void 0:e.descr))return void w("Die Beschreibung darf nicht leer sein.");if(0===(null===(s=this.measure)||void 0===s?void 0:s.solveRisks.length))return void w("Eine Maßnahme muss mindestens eine Gefährdung lösen.");if(void 0===this.measure)return void w("Etwas ist schief gelaufen.");const i={descr:this.measure.descr,solveRisks:[...this.measure.solveRisks],causeRisks:[...this.measure.causeRisks]};return this.createNew?V.measures.add(i).then((e=>{w("Die Maßnahme wurde hinzugefügt.","success"),this.$emit("hasAdded",{id:e,...this.measure})})).catch((e=>{throw w("Beim Speichern ist ein Fehler aufgetreten.","danger"),e})):void 0!==this.id?V.measures.update(this.id,i).then((()=>{w("Änderungen gespeichert.","success"),this.$emit("hasSaved",{id:this.id,...this.measure})})).catch((e=>{throw w("Beim Speichern ist ein Fehler aufgetreten.","warning"),e})):void w("Ungültige ID","danger")}},mounted(){this.measure=this.defaultValues,console.log(this.measure),this.loadFromDb()}},D=r(s,[["render",function(e,s,i,a,t,l){const d=o("ion-input"),u=o("ion-item"),n=o("ion-list"),r=o("ion-label"),p=o("ion-button"),_=o("ion-list-header"),R=o("RiskList"),y=o("RiskCatalog"),b=o("GenericEditModal");return t.measure?(c(),m(k,{key:0},[h(n,{inset:""},{default:v((()=>[h(u,null,{default:v((()=>[h(d,{label:"Beschreibung","label-placement":"floating",modelValue:t.measure.descr,"onUpdate:modelValue":s[0]||(s[0]=e=>t.measure.descr=e)},null,8,["modelValue"])])),_:1})])),_:1}),h(R,{modelValue:t.measure.solveRisks,"onUpdate:modelValue":s[2]||(s[2]=e=>t.measure.solveRisks=e),"forbid-deletion":"",inverted:"",inset:""},{header:v((()=>[h(_,null,{default:v((()=>[h(r,null,{default:v((()=>[f("Maßnahme für...")])),_:1}),h(p,{onClick:s[1]||(s[1]=e=>t.addSolvedRisks=!0)},{default:v((()=>[f("Hinzufügen")])),_:1})])),_:1})])),_:1},8,["modelValue"]),h(b,{"is-open":t.addSolvedRisks,onWillDismiss:s[4]||(s[4]=e=>t.addSolvedRisks=!1),"hide-save":""},{default:v((()=>[h(y,{modelValue:t.measure.solveRisks,"onUpdate:modelValue":s[3]||(s[3]=e=>t.measure.solveRisks=e),"link-to-function":()=>{}},null,8,["modelValue"])])),_:1},8,["is-open"]),h(R,{modelValue:t.measure.causeRisks,"onUpdate:modelValue":s[6]||(s[6]=e=>t.measure.causeRisks=e),"forbid-deletion":"",inverted:"",inset:""},{header:v((()=>[h(_,null,{default:v((()=>[h(r,null,{default:v((()=>[f("Verursachte Gefährdungen...")])),_:1}),h(p,{onClick:s[5]||(s[5]=e=>t.addCausedRisks=!0)},{default:v((()=>[f("Hinzufügen")])),_:1})])),_:1})])),_:1},8,["modelValue"]),h(b,{"is-open":t.addCausedRisks,onWillDismiss:s[8]||(s[8]=e=>t.addCausedRisks=!1),"hide-save":""},{default:v((()=>[h(y,{modelValue:t.measure.causeRisks,"onUpdate:modelValue":s[7]||(s[7]=e=>t.measure.causeRisks=e),"link-to-function":()=>{},exclude:t.measure.solveRisks},null,8,["modelValue","exclude"])])),_:1},8,["is-open"])],64)):g("",!0)}]]);e("default",p({__name:"MeasureEditPage",setup(e){let s,a={descr:"",solveRisks:[],causeRisks:[]},t=!1;const l=_();if("/measures/new"===l.path){if(t=!0,void 0!==l.query.for){let e=parseInt(l.query.for);a.solveRisks.push(e)}}else s=parseInt(l.params.id);return(e,l)=>(c(),R(i,{onShouldCancel:l[2]||(l[2]=s=>e.$router.back()),onSubmit:l[3]||(l[3]=s=>{e.$refs.editor.saveToDb()})},{default:v((()=>[(c(),R(y,null,{default:v((()=>[h(D,{ref:"editor",id:b(s),"create-new":b(t),"default-values":b(a),onHasAdded:l[0]||(l[0]=s=>e.$router.back()),onHasSaved:l[1]||(l[1]=s=>e.$router.back())},null,8,["id","create-new","default-values"])])),_:1}))])),_:1}))}}))}}}));
