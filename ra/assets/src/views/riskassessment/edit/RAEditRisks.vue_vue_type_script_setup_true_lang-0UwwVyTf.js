import{y as N,t as m,bi as w,x as R,aD as b,C as o,D as u,E as a,F as s,u as e,br as v,X as f,O as i,bs as E,J as p,a$ as F,T as B,aK as G,b1 as U,M as I,L as A,N as k,b4 as Z,S as q,ba as z,bp as P,Q as g,bb as W,am as H,b3 as Q,V as J,Y as K,W as X,_ as L,P as Y,ae as O}from"../../../../vendor-fe-4Mo55.js";import{u as j,b as ee}from"../../../composables/riskassessment-yedfBpr3.js";import{_ as ae}from"../../../components/RiskCatalog.vue_vue_type_script_setup_true_lang-lOpLqJd8.js";import{G as se}from"../../../components/GenericEditModal-0xE-bflg.js";import{l as V}from"../../../composables/liveriskstree-iM3KwOgD.js";import{l as te}from"../../../composables/livequery-P21yeuae.js";import{_ as ne}from"../../../components/AddedByList.vue_vue_type_script_setup_true_lang-6igqA112.js";import{T as le}from"../../../components/TemplateRiskAssessmentPage-jWM7FwVS.js";import{a as re}from"../../../composables/helpers-Kc8KqJcx.js";const oe={class:"ion-text-right"},pe=N({__name:"RAEditRisks",setup(ie){m(0),w(()=>console.log("will enter"));const n=j(),x=ee(),y=te.table("measures"),M=R(()=>V.isReady()?x.value.map(l=>({risk:V.get(l),meta:n.getMeta(l)})):[]),d=m("Z");m(-1);const S=R(()=>M.value.filter(l=>l.risk.sector===d.value));["Z","U","A"].includes(b().query.sector)&&(d.value=b().query.sector);const _=m(!1);function T(l){n.risks=n.risks.filter(r=>r!==l.risk.id)}function $(l){re("Die Gefährdung wirklich aus der Liste entfernen?",{text:"Löschen",role:"destructive",icon:O,handler:()=>{T(l)}})}const D="/riskassessment/"+n.id+"/risks";return(l,r)=>(o(),u(le,null,{default:a(()=>[s(e(E),{value:d.value,onIonChange:r[0]||(r[0]=t=>{d.value=t.detail.value,l.$router.replace({query:{sector:t.detail.value}})})},{default:a(()=>[s(e(v),{value:"Z"},{default:a(()=>[s(e(f),null,{default:a(()=>[i("Zugang")]),_:1})]),_:1}),s(e(v),{value:"U"},{default:a(()=>[s(e(f),null,{default:a(()=>[i("Umgebung")]),_:1})]),_:1}),s(e(v),{value:"A"},{default:a(()=>[s(e(f),null,{default:a(()=>[i("Arbeit")]),_:1})]),_:1})]),_:1},8,["value"]),e(n).ready&&e(y).isReady()?(o(),p(I,{key:0},[s(e(U),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:a(()=>[s(e(F),{onClick:r[1]||(r[1]=t=>_.value=!0)},{default:a(()=>[s(e(B),{icon:e(G)},null,8,["icon"])]),_:1})]),_:1}),(o(!0),p(I,null,A(S.value,t=>(o(),u(e(Z),{key:t.risk.id,class:"risk-card"},{default:a(()=>[s(e(B),{icon:e(q),color:"success",class:"checkmark ion-padding ion-float-right",size:"large"},null,8,["icon"]),s(e(z),null,{default:a(()=>[s(e(P),null,{default:a(()=>{var c,h,C;return[i(g((h=(c=t.risk.factor)==null?void 0:c.category)==null?void 0:h.descr)+" ➤ "+g((C=t.risk.factor)==null?void 0:C.descr),1)]}),_:2},1024),s(e(W),{style:{"font-size":"1.1rem"}},{default:a(()=>[i(g(t.risk.descr),1)]),_:2},1024),e(n).meta[t.risk.id].addedBy.length>0?(o(),u(e(H),{key:0,style:{"margin-bottom":"1rem"}},{default:a(()=>[s(ne,{"trigger-list":e(n).meta[t.risk.id].addedBy},null,8,["trigger-list"])]),_:2},1024)):k("",!0)]),_:2},1024),s(e(Q),{class:"ion-no-margin ion-no-padding"},{default:a(()=>[e(n).getMeasures(t.risk.id).length?(o(),u(e(J),{key:0,class:"risk-solved ion-no-padding ion-no-margin",lines:"none"},{default:a(()=>[s(e(K),{class:"ion-no-margin"},{default:a(()=>[s(e(f),null,{default:a(()=>[i("Gewählte Maßnahmen")]),_:1})]),_:1}),(o(!0),p(I,null,A(e(n).getMeasures(t.risk.id),c=>(o(),u(e(X),{class:"ion-no-margin"},{default:a(()=>[i(g(e(y).get(c).descr),1)]),_:2},1024))),256))]),_:2},1024)):k("",!0),Y("div",oe,[e(n).meta[t.risk.id].addedBy.length===0?(o(),u(e(L),{key:0,fill:"clear",color:"danger",onClick:c=>$(t)},{default:a(()=>[i("Löschen")]),_:2},1032,["onClick"])):k("",!0),s(e(L),{fill:"clear","router-link":D+"/"+t.risk.id},{default:a(()=>[i("Bearbeiten")]),_:2},1032,["router-link"])])]),_:2},1024)]),_:2},1024))),128)),s(se,{"is-open":_.value,onWillDismiss:r[3]||(r[3]=t=>_.value=!1),"hide-save":""},{default:a(()=>[s(ae,{modelValue:e(n).risks,"onUpdate:modelValue":r[2]||(r[2]=t=>e(n).risks=t),sector:d.value,"link-to-function":()=>{}},null,8,["modelValue","sector"])]),_:1},8,["is-open"])],64)):k("",!0)]),_:1}))}});export{pe as _};
