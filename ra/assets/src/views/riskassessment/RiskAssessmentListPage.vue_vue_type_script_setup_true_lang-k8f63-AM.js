import{y as w,bo as x,C as l,D as d,E as t,F as n,u as e,a$ as z,T as A,aK as v,b1 as D,J as I,L,M as S,b4 as $,ba as B,bb as E,Q as c,O as o,bp as F,b3 as N,_ as u,N as R,S as y,ae as T}from"../../../vendor-fe-4Mo55.js";import{d as f}from"../../composables/database-EV4tUyzx.js";import{u as V,d as Q}from"../../composables/riskassessment-yedfBpr3.js";import{l as m}from"../../composables/livequery-P21yeuae.js";import{_ as G}from"../../components/TemplateMainPage.vue_vue_type_script_setup_true_lang-XxHgkime.js";import{a as k}from"../../composables/helpers-Kc8KqJcx.js";const q=w({__name:"RiskAssessmentListPage",setup(H){const p=x(),b=m.table("riskassessmentsmeta").entries(),r=V();function _(){f.riskassessments.add({...Q}).then(s=>{const i=Math.floor(Date.now()/1e3);f.riskassessmentsmeta.add({id:s,descr:"Neue Gefährdungsbeurteilung "+s,created:i,lastChange:i}).then(()=>{})})}function g(s){r.id===s&&p.push("/riskassessment/"+s),r.id!==void 0&&s!==r.id&&r.modified()?k("In der geöffneten Einsatzplanung gibt es noch ungespeicherte Änderungen. Diese gehen verloren wenn eine andere geöffnet wird. Soll die Einsatzplanung trotzdem geöffnet werden?",{text:"Öffnen",role:"submit",icon:y,handler:()=>{r.loadFromDb(s)}}):r.loadFromDb(s)}function h(s){k("Soll der Einsatzplan wirklich unwideruflich gelöscht werden?",{text:"Löschen",icon:T,handler:()=>{m.table("riskassessments").delete(s),m.table("riskassessmentsmeta").delete(s)}})}return(s,i)=>(l(),d(G,null,{default:t(()=>[n(e(D),{slot:"fixed",vertical:"bottom",horizontal:"end"},{default:t(()=>[n(e(z),{onClick:i[0]||(i[0]=a=>_())},{default:t(()=>[n(e(A),{icon:e(v)},null,8,["icon"])]),_:1})]),_:1}),(l(!0),I(S,null,L(e(b),a=>(l(),d(e($),null,{default:t(()=>[n(e(B),{onClick:C=>g(a.id)},{default:t(()=>[n(e(E),null,{default:t(()=>[o(c(a.descr),1)]),_:2},1024),n(e(F),null,{default:t(()=>[o("Zuletzt geändert: "+c(new Date(a.lastChange*1e3).toLocaleString("de")),1)]),_:2},1024)]),_:2},1032,["onClick"]),a.id===e(r).id?(l(),d(e(N),{key:0},{default:t(()=>[n(e(u),{size:"small",fill:"clear",color:"danger",onClick:C=>h(a.id)},{default:t(()=>[o("Löschen")]),_:2},1032,["onClick"]),n(e(u),{size:"small",fill:"clear","router-link":"/riskassessment/".concat(a.id,"/export")},{default:t(()=>[o("Export")]),_:2},1032,["router-link"]),n(e(u),{size:"small",fill:"clear","router-link":"/riskassessment/".concat(a.id)},{default:t(()=>[o("Bearbeiten")]),_:2},1032,["router-link"])]),_:2},1024)):R("",!0)]),_:2},1024))),256))]),_:1}))}});export{q as _};
