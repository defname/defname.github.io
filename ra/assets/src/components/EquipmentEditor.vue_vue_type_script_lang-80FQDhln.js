import{V as r,W as a,X as u,Y as o,Z as d,_ as m}from"../../vendor-fe-4Mo55.js";import{d as s}from"../composables/database-EV4tUyzx.js";import{_ as h}from"./RiskList.vue_vue_type_script_setup_true_lang-12p0yvzO.js";import{G as p}from"./GenericEditModal-0xE-bflg.js";import{_ as c}from"./RiskCatalog.vue_vue_type_script_setup_true_lang-lOpLqJd8.js";import{p as i}from"../composables/helpers-Kc8KqJcx.js";import{_ as f}from"./TagInput.vue_vue_type_script_setup_true_lang-wUUN7B7N.js";import{l}from"../composables/livequery-P21yeuae.js";const D={components:{IonList:r,IonItem:a,IonLabel:u,IonListHeader:o,IonInput:d,RiskList:h,RiskCatalog:c,GenericEditModal:p,IonButton:m,TagInput:f},emits:["hasSaved","hasAdded"],props:{id:{type:Number},createNew:Boolean,defaultValues:{type:Object,default:{descr:"",tags:[],causeRisks:[]}}},data(){return{equipment:void 0,addCausedRisks:!1}},computed:{allTags(){return l.table("equipment").entries().reduce((t,n)=>(t.push(...n.tags),t),[])}},methods:{loadFromDb(){this.id!==void 0&&s.equipment.get(this.id).then(e=>{if(e===void 0){i("Es existiert keine Ausrüstung mit der ID "+this.id+" in der Datenbank.","danger");return}this.equipment=e})},saveToDb(){if(this.equipment===void 0){i("Etwas ist schief gelaufen.");return}if(this.equipment.descr===""){i("Die Beschreibung darf nicht leer sein.");return}const e={descr:this.equipment.descr,tags:[...this.equipment.tags],causeRisks:[...this.equipment.causeRisks]};if(this.createNew&&s.equipment.add(e).then(t=>{i(e.descr+" wurde hinzugefügt.","success"),this.$emit("hasAdded",{id:t,...this.equipment})}).catch(t=>{throw i("Beim Speichern ist ein Fehler aufgetreten.","danger"),t}),this.id===void 0){i("Ungültige ID","danger");return}s.equipment.update(this.id,e).then(()=>{i("Änderungen gespeichert.","success"),console.log(e),this.$emit("hasSaved",{id:this.id,...this.equipment})}).catch(t=>{throw i("Beim Speichern ist ein Fehler aufgetreten.","warning"),t})}},mounted(){this.equipment=this.defaultValues,console.log(this.equipment),this.loadFromDb()}};export{D as _};
