import{y as j,t as q,x as R,C as s,J as b,F as a,u as e,aE as z,D as u,E as t,M as g,L as V,aF as K,N as k,aG as P,W as $,T as h,aH as T,X as x,Q as A,O as c,V as Z,aI as Y,aJ as ee,a9 as ne,ab as te,am as ae,ac as F,ad as y,aK as le,aL as oe,ae as G,aM as se,aN as ie,aO as re,aP as ue,aQ as de,aR as ce,aS as me,aT as fe,aU as ve,aV as he,aW as be,aX as ge}from"../../vendor-fe-4Mo55.js";import{d as I,S as D}from"../composables/database-EV4tUyzx.js";import{R as L}from"../composables/riskcatalog-hVdw2NQQ.js";import{a as ke,p as C}from"../composables/helpers-Kc8KqJcx.js";import{S as pe}from"./Sektor-XnNz8QKu.js";import{l as ye}from"../composables/liveriskstree-iM3KwOgD.js";const Ae=j({__name:"RiskCatalog",props:{sector:String,modelValue:Array,exclude:Array,inverted:Boolean,linkToFunction:{type:Function,default:l=>"/risks/".concat(l.id)}},emits:["update:modelValue"],setup(l,{emit:O}){const m=l,B=O,p={},E=[{text:"Abbrechen",role:"cancel"},{text:"Speichern",role:"submit"}],S=ye,r=q(),N=R(()=>{if(r.value!==void 0)return S.get(r.value)}),_=R(()=>N.value?N.value.descr:""),W={1:ie,2:re,3:ue,4:de,5:ce,6:me,7:fe,8:ve,9:he,10:be,11:T};async function H(n){if(m.sector===void 0)(async()=>{await(await ge.create({header:"Neue Gefährdung",message:"In welchem Sektor besteht die Gefährung?",inputs:[{type:"radio",label:"Zugang",value:D.Access},{type:"radio",label:"Umgebung",value:D.Environment},{type:"radio",label:"Arbeit",value:D.Work}],buttons:[{text:"Abbrechen",role:"cancel"},{text:"Hinzufügen",role:"submit",handler:d=>I.risks.add(new L("Neue Gefährdung",d,n))}]})).present()})();else{const i=m.sector;return I.risks.add(new L("Neue Gefährdung",i,n))}}async function J(n){I.risks.where("id").equals(n).delete().then(()=>{C("Gefährdung wurde aus der Datenbank gelöscht","success")}).catch(i=>{console.log(i)})}async function M(n){if(n.id===void 0)return;const i={text:"Löschen",role:"destructive",icon:G,handler:Q(n.id)};p[n.id]!==null&&p[n.id].$el.close(),await ke("'".concat(n.descr,"' wirklich aus der Datenbank löschen?"),i)}function Q(n){return()=>{J(n)}}function w(n){n===void 0||m.modelValue===void 0||(m.modelValue.includes(n)?B("update:modelValue",m.modelValue.filter(i=>i!==n)):B("update:modelValue",[...m.modelValue,n]))}async function U(n,i){if(i===""){C("Die Beschreibung darf nicht leer sein!","danger");return}I.risks.update(n,{descr:i}).then(()=>{C("Änderungen gespeichert","success")}).catch(()=>{C("Beim Speichern ist ein Fehler aufgetreten","danger")})}async function X(n){if(r.value!==void 0){if(p[r.value].$el.close(),n.detail.role!="submit"){r.value=void 0;return}U(r.value,n.detail.data.values[0]),r.value=void 0}}return(n,i)=>(s(),b(g,null,[a(e(z),{isOpen:r.value!==void 0,header:"Beschreibung eingeben",buttons:E,inputs:[{placeholder:"Beschreibung",value:_.value}],"backdrop-dismiss":!0,onDidDismiss:X},null,8,["isOpen","inputs"]),e(S)?(s(),u(e(K),{key:0},{default:t(()=>[(s(!0),b(g,null,V(e(S).categories,f=>(s(),u(e(P),{key:f.id},{default:t(()=>[a(e($),{slot:"header"},{default:t(()=>[a(e(h),{slot:"start",icon:f.id?W[f.id]:e(T)},null,8,["icon"]),a(e(x),null,{default:t(()=>[c(A(f.descr),1)]),_:2},1024)]),_:2},1024),a(e(Z),{slot:"content"},{default:t(()=>[(s(!0),b(g,null,V(f.factors,d=>(s(),u(e(Y),{key:d.id},{default:t(()=>[a(e(ee),null,{default:t(()=>[a(e(x),null,{default:t(()=>[c(A(d.descr),1)]),_:2},1024),d.id?(s(),u(e(h),{key:0,slot:"end",icon:e(ne),color:"primary",onClick:o=>H(d.id)},null,8,["icon","onClick"])):k("",!0)]),_:2},1024),(s(!0),b(g,null,V(d.risks,o=>(s(),b(g,{key:o.id},[(l.exclude===void 0||!l.exclude.includes(o.id))&&(l.modelValue===void 0||l.modelValue.includes(o.id)===l.inverted)&&(!l.sector||o.sector===l.sector)?(s(),u(e(te),{key:0,ref_for:!0,ref:v=>p[o.id]=v},{default:t(()=>[a(e($),{"router-link":l.linkToFunction(o)},{default:t(()=>[a(e(x),null,{default:t(()=>[c(A(o.descr),1)]),_:2},1024),l.sector?k("",!0):(s(),u(e(ae),{key:0,slot:"end"},{default:t(()=>[a(pe,{sector:o.sector},null,8,["sector"])]),_:2},1024))]),_:2},1032,["router-link"]),l.modelValue!==void 0?(s(),u(e(F),{key:0,side:"start",onIonSwipe:v=>w(o.id)},{default:t(()=>[l.inverted?(s(),u(e(y),{key:1,color:"warning",onClick:v=>w(o.id),expandable:""},{default:t(()=>[a(e(h),{icon:e(oe),slot:"start"},null,8,["icon"]),c(" Enfernen ")]),_:2},1032,["onClick"])):(s(),u(e(y),{key:0,color:"success",onClick:v=>w(o.id),expandable:""},{default:t(()=>[a(e(h),{icon:e(le),slot:"start"},null,8,["icon"]),c(" Auswählen ")]),_:2},1032,["onClick"]))]),_:2},1032,["onIonSwipe"])):k("",!0),a(e(F),{side:"end"},{default:t(()=>[a(e(y),{color:"danger",onClick:v=>M(o)},{default:t(()=>[a(e(h),{icon:e(G),slot:"end"},null,8,["icon"]),c(" Löschen ")]),_:2},1032,["onClick"]),a(e(y),{onClick:v=>r.value=o.id},{default:t(()=>[a(e(h),{icon:e(se),slot:"end"},null,8,["icon"]),c(" Bearbeiten ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1536)):k("",!0)],64))),128))]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})):k("",!0)],64))}});export{Ae as _};
